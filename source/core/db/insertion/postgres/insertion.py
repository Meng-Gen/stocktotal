# coding: utf-8import postgresqlclass Insertion():    def __init__(self):        self.CONN_STRING = 'pq://stocktotal:stocktotal@localhost:5432/stocktotal'        self.DB_CONN = None            def open(self):        self.DB_CONN = postgresql.open(self.CONN_STRING)            def close(self):        self.DB_CONN.close()        self.DB_CONN = None    def insert(self, sql_cmd, record):        try:            fixed_record = [None if _.strip() == '' else _ for _ in record]            prepared_stmt = self.DB_CONN.prepare(sql_cmd)            prepared_stmt(*fixed_record)        except postgresql.exceptions.UniqueError:            pass    def insert_stmt(self, sql_cmd, record):        try:            prepared_stmt = self.DB_CONN.prepare(sql_cmd)            prepared_stmt(*record)        except postgresql.exceptions.UniqueError:            pass                def insert_balance_sheet(self, record):        sql_cmd = \            '''            insert into BalanceSheet(                stock_code,                 report_type,                 report_date,                 activity_date,                 item,                 number            ) values($1, $2, $3, $4, $5, $6::text::float8)            '''        self.insert_stmt(sql_cmd, record)            def insert_income_stmt(self, record):        sql_cmd = \            '''            insert into IncomeStmt(                stock_code,                 report_type,                 report_date,                 activity_date,                 item,                 number            ) values($1, $2, $3, $4, $5, $6::text::float8)            '''        self.insert_stmt(sql_cmd, record)            def insert_cash_flow_stmt(self, record):        sql_cmd = \            '''            insert into CashFlowStmt(                stock_code,                 report_type,                 report_date,                 activity_date,                 item,                 number            ) values($1, $2, $3, $4, $5, $6::text::float8)            '''        self.insert_stmt(sql_cmd, record)            def insert_stock_code(self, record):        sql_cmd = \            '''            insert into StockCode(                code,                 name,                 isin_code,                 listing_date,                 market_category,                 industry_category,                 cfi_code            ) values($1, $2, $3, $4::text::date, $5, $6, $7)            '''        self.insert(sql_cmd, record)                def insert_trading_summary(self, record):        sql_cmd = \            '''            insert into TradingSummary(                trading_date,                 item,                 buy,                 sell,                 diff            ) values($1::text::date, $2, $3::text::float8, $4::text::float8, $5::text::float8)            '''        self.insert(sql_cmd, record)                def insert_market_stat(self, record):        sql_cmd = \            '''            insert into MarketStatistics(                report_date,                 activity_date,                 report_type,                total_trading_value,                listed_co_number,                capital_issued,                total_listed_shares,                market_capitalization,                trading_volume,                trading_value,                trans_number,                average_taiex,                volume_turnover_rate,                per,                dividend_yield,                pbr,                trading_days            ) values(                $1::text::date,                 $2::text::date,                 $3,                 $4::text::float8,                  $5::text::float8,                 $6::text::float8,                 $7::text::float8,                 $8::text::float8,                 $9::text::float8,                 $10::text::float8,                 $11::text::float8,                 $12::text::float8,                 $13::text::float8,                 $14::text::float8,                 $15::text::float8,                 $16::text::float8,                 $17::text::float8            )            '''        self.insert(sql_cmd, record)                def insert_listed_co_stat(self, record):        sql_cmd = \            '''            insert into ListedCoStatistics(                report_date,                 stock_code,                latest_price,                per,                yield,                pbr            ) values(                $1::text::date,                 $2,                 $3::text::float8,                 $4::text::float8,                 $5::text::float8,                 $6::text::float8            )            '''                  self.insert(sql_cmd, record)        def insert_operating_income(self, record):        sql_cmd = \            '''            insert into OperatingIncome(                report_date,                 stock_code,                activity_date,                income            ) values($1::text::date, $2, $3::text::date, $4::text::float8)            '''        self.insert(sql_cmd, record)    def insert_capital_structure(self, record):        sql_cmd = \            '''            insert into CapitalStructure(                stock_code,                activity_date,                 debut,                 par_value,                authorized_capital_stock,                authorized_capital,                paidin_capital_stock,                paidin_capital,                ipo,                spo,                capitalization_capital_reserve,                capitalization_retained_earnings,                by_acquisition,                capital_reduction,                capital_others,                 capital_other_than_cash,                note            ) values(                $1,                 $2::text::date,                 $3,                 $4::text::float8,                $5::text::float8,                 $6::text::float8,                 $7::text::float8,                 $8::text::float8,                 $9::text::float8,                 $10::text::float8,                 $11::text::float8,                 $12::text::float8,                 $13::text::float8,                 $14::text::float8,                 $15,                 $16,                 $17            )            '''        self.insert(sql_cmd, record)            def insert_capital_structure_summary(self, record):        sql_cmd = \            '''            insert into CapitalStructureSummary(                stock_code,                activity_date,                spo,                capitalization_earnings,                capitalization_reserve_and_others            ) values(                $1,                 $2::text::date,                 $3::text::float8,                 $4::text::float8,                $5::text::float8            )            '''        self.insert(sql_cmd, record)            def insert_stock_dividend(self, record):        sql_cmd = \            '''            insert into StockDividend(                stock_code,                activity_date,                cash_dividend,                stock_dividend_from_retained_earnings,                stock_dividend_from_capital_reserve,                stock_dividend,                total_dividend,                profit_sharing_percentage            ) values(                $1,                 $2::text::date,                 $3::text::float8,                 $4::text::float8,                $5::text::float8,                $6::text::float8,                $7::text::float8,                $8::text::float8            )            '''        self.insert(sql_cmd, record)    def insert_listed_co_trading_info(self, record):        sql_cmd = \            '''            insert into ListedCoTradingInfo(                stock_code,                activity_date,                highest_price,                lowest_price,                weighted_average_price,                trans,                trade_value,                trade_volume,                turnover_ratio            ) values(                $1,                 $2::text::date,                 $3::text::float8,                 $4::text::float8,                $5::text::float8,                $6::text::float8,                $7::text::float8,                $8::text::float8,                $9::text::float8            )            '''        self.insert(sql_cmd, record)            def insert_historical_price(self, record):        sql_cmd = \            '''            insert into HistoricalPrices(                stock_code,                activity_date,                open,                high,                low,                close,                volume,                adj_close            ) values(                $1,                 $2::text::date,                 $3::text::float8,                 $4::text::float8,                $5::text::float8,                $6::text::float8,                $7::text::float8,                $8::text::float8            )            '''        self.insert(sql_cmd, record)